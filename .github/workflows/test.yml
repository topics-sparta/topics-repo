name: Test
on:
    push:
        branches: [main]
    pull_request:
        branches: [main]
      

jobs:
  run-unit-tests:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./topics-project
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20.2.0
      - name: Install Dependencies
        run: npm install
      - name: Run Tests
        run: npm test
      - name: Start the Application
        run: npm start &
  run-e2e-tests:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./topics-project
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20.2.0
      - name: Install Dependencies
        run: npm install
      - name: Start the Application
        run: npm start &
      - name: Wait for the Application to be Ready
        run: |
          until curl --output /dev/null --silent --head --fail http://localhost:3000; do
            echo 'Waiting for application to start...'
            sleep 5
          done
      - name: install playwright browsers
        run: npx playwright install --with-deps
      - name: Run Tests
        env:
            NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
            NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_KEY }}
        run: npx playwright test 
  build:
    runs-on: ubuntu-latest
    steps:
      - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v4
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: echo "üçè This job's status is ${{ job.status }}."